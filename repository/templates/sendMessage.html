{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat with {{ recipient.get_full_name }}</title>
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'fontawesome/css/all.min.css' %}" rel="stylesheet">
  <style>
    .chat-container {
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fff;
      height: 800px;
      display: flex;
      flex-direction: column;
    }
    .chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    .message-bubble {
      max-width: 70%;
      padding: 10px;
      border-radius: 12px;
      margin-bottom: 5px;
      position: relative;
    }
    .sent {
      background-color: #dcf8c6;
      align-self: flex-end;
    }
    .received {
      background-color: #f1f0f0;
      align-self: flex-start;
    }
    .timestamp {
      font-size: 0.75rem;
      color: gray;
      text-align: right;
    }
    .date-separator {
      text-align: center;
      margin: 10px 0;
      font-size: 0.9rem;
      color: #999;
    }
    textarea {
      resize: none;
    }
    body{
      background-image:url("{% static 'img/school.png' %}")
    }
  </style>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Font Awesome CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-7">
        <div class="chat-container">
          
          <!-- Chat Header -->
          <div class="p-3 border-bottom bg-light d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <i class="fa fa-user-circle fa-2x text-success me-2"></i>
              <h6 class="mb-0">Chat with <b>{{ recipient.first_name }} {{ recipient.last_name }}</b></h6>
            </div>
            <a href="{% url 'dashboard' %}" class="text-decoration-none">
              <i class="fa fa-arrow-left fa-lg text-primary"></i>
            </a>
          </div>

          <!-- Chat Messages -->
          <div class="chat-box d-flex flex-column">
            {% for date, messages in grouped_messages %}
              <div class="date-separator">
                {% if date == today %}
                  Today
                {% elif date == yesterday %}
                  Yesterday
                {% else %}
                  {{ date|date:"F j, Y" }}
                {% endif %}
              </div>

              {% for mess in messages %}
                <div class="d-flex {% if mess.sender == request.user %}justify-content-end{% else %}justify-content-start{% endif %}">
                  <div class="message-bubble {% if mess.sender == request.user %}sent{% else %}received{% endif %}">
                    {{ mess.content }}
                    <div class="timestamp">
                      {{ mess.timestamp|time:"g:i A" }}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% endfor %}
          </div>

          <!-- Message Input -->
          <form method="POST" action="" class="border-top p-3">
            {% csrf_token %}
            <div class="d-flex">
              <textarea name="message" class="form-control me-2" rows="1" placeholder="Type a message" required></textarea>
              <button type="submit" class="btn btn-primary">
                <i class="fa fa-paper-plane"></i>
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>

  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
